<!DOCTYPE html>
<html>
<head>

</head>

<body>
    <div id="calendar">

    </div>
</body>

<script>

    const SUNDAY = 0;
    const MONDAY = 1;
    const TUESDAY = 2;
    const WEDNESDAY = 3;
    const THURSDAY = 4;
    const FRIDAY = 5;
    const SATURDAY = 6;

    const JANUARY = 0;
    const FEBRUARY = 1;
    const MARCH = 2;
    const APRIL = 3;
    const MAY = 4;
    const JUNE = 5;
    const JULY = 6; 
    const AUGUST = 7;
    const SEPTEMBER = 8;
    const OCTOBER = 9;
    const NOVEMBER = 10;
    const DECEMBER = 11;

    const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    Date.prototype.getWeekDay = function()
    {        
        return WEEKDAYS[this.getDay()];
    }

    Date.prototype.nextDate = function()
    {
        this.setDate(this.getDate()+1);
    }

    Date.nthDayOfMonth = function(count, day, month, year)
    {
        if (year == null) year = new Date().getFullYear();
        var date = new Date(year, month, 1);
        var counter = 0;
        if (date.getWeekDay() == WEEKDAYS[day]) counter++;
        while (counter < count) 
        {
            date.nextDate();
            if (date.getWeekDay() == WEEKDAYS[day]) counter++;
        }
        return date;
    }

    Date.lastDayOfMonth = function(day, month, year)
    {        
        if (year == null) year = new Date().getFullYear();
        var date = new Date(year, month, 1);
        var list = [];
        while (date.getMonth() == month) 
        {
            if (date.getWeekDay() == WEEKDAYS[day])
            {                
                list.push(new Date(date));                
            } 
            date.nextDate();            
            if (date.getMonth() > month) break;                     
        }
        return list.pop();
    }

    Date.prototype.backDate = function(offset)
    {
        this.setDate(this.getDate() - offset);
        this.isBackdate = true;        
        return this;
    }

    Date.findSetHoliday = function(month, date, year)
    {
        if (year == null) year = new Date().getFullYear();
        var holiday = new Date(year, month, date);
        if (holiday.getDay() == SATURDAY)
        {
            holiday.backDate(1);            
        }
        else if (holiday.getDay() == SUNDAY)
        {
            holiday.nextDate();
        }
        return holiday; 
    }

    Date.NewYear = function(year)
    {
        var newDate = new Date();
        if (year == null) year = new Date().getFullYear();
        newDate.setFullYear(year);
        newDate.setDate(1);
        newDate.setMonth(0);
        return newDate;
    }

    Date.getFederalHolidays = function(startDate)
    {
        function calendarYear(month)
        {
            if (month < startDate.getMonth())
                return startDate.getFullYear() + 1;
            else
                return startDate.getFullYear();
        }
        
        var holidays = [
            Date.NewYear(calendarYear(JANUARY)),
            Date.nthDayOfMonth(3,MONDAY, JANUARY, calendarYear(JANUARY)),
            Date.nthDayOfMonth(3,MONDAY, FEBRUARY, calendarYear(FEBRUARY)),
            Date.lastDayOfMonth(MONDAY, MAY, calendarYear(MAY)),        
            Date.findSetHoliday(JULY,4,calendarYear(JULY)),
            Date.nthDayOfMonth(1,MONDAY,SEPTEMBER, calendarYear(SEPTEMBER)),
            Date.nthDayOfMonth(2,MONDAY,OCTOBER, calendarYear(OCTOBER)),
            Date.findSetHoliday(NOVEMBER,11, calendarYear(NOVEMBER)),
            Date.nthDayOfMonth(4,THURSDAY,NOVEMBER, calendarYear(NOVEMBER)),
            Date.findSetHoliday(DECEMBER,25, calendarYear(DECEMBER))
        ];

        return holidays;
    }
    
    Date.prototype.getMonthStr = function()
    {        
        return MONTHS[this.getMonth()];
    }

    Date.prototype.toISODate = function()
    {
        var str = this.toISOString().split('T')[0].replace(/-/g,'');
        return str;
    }

    Date.fromISODate = function(str)
    {
        var newDate = null;
        try
        {
            var year = str.substr(0,4);
            var month = parseInt(str.substr(4,2))-1;
            var date = str.substr(6,2);
            newDate = new Date(year, month, date);
        }
        catch (exception)
        {
            console.log(exception);
            return null;
        }
        return newDate;
    }

    Date.prototype.getCalendarStr = function()
    {
        return this.getWeekDay() + " " + this.getMonthStr() + " " + this.getDate() + ", " + this.getFullYear();
    }

    class Calendar
    {
        #myStartDate = new Date();
        #myDivId = "calendar";
    
        constructor(divId = "calendar", startDate = new Date())
        {
            this.myStartDate = new Date(startDate);
            this.myDivId = divId;
            this.draw();           
        }

        insertDay(someDate)
        {
            console.log("insertDay: ", someDate);
            var day = document.createElement("div");
            day.id = someDate.toISODate();
            day.innerText = someDate.getCalendarStr();        
            day.classList.add("date");  

            if (!someDate.isBackdate)
            {
                var isSunday = someDate.getDay() === 0;
                var isSaturday = someDate.getDay() === 6;
                var isWeekend = isSaturday || isSunday;
                if (isWeekend) day.classList.add("weekend");
                if (isSunday) day.classList.add("sunday");
                if (isSaturday) day.classList.add("saturday");  
            }
            else
            {
                day.classList.add("backdate");
            } 
            
            var calendar = document.getElementById(this.myDivId);
            if (calendar != null) calendar.appendChild(day);
        }    

        draw()
        {
            var days = 365;
            var offsetDays = this.myStartDate.getDay();
            for (var offset = offsetDays; offset > 0; offset--) 
            {
                var date = new Date(this.myStartDate);
                this.insertDay(date.backDate(offset));
            }

            var date = new Date(this.myStartDate);
            for (var count = 0; count <= days; count++) 
            {
                this.insertDay(date);
                date.nextDate();
            }

            Date.getFederalHolidays(this.myStartDate).forEach(function(date)
            {
                console.log(date);
                var calendarDate = document.getElementById(date.toISODate())
                if (calendarDate != null)
                {
                    calendarDate.classList.add("holiday");
                }            
            });
        }
    }
       
    function main() 
    {
        var args = window.location.search.substring(1) || null;
        var start = Date.fromISODate(args) || Date.NewYear();

        var calendar = new Calendar(divId = "calendar", startDate = start);        
        
    }

    document.addEventListener("DOMContentLoaded", function(event) { 
        main();
    });

</script>

<style>
    #calendar {
        display: table;
    }

    div.date {
        float: left;
        border : 1px solid black;
        height: 20vh;
        width: 10vw;
        padding : 1px;
        display: inline;
    }

    div.sunday {
        display: block;
        clear: both;
    }

    div.weekend {
        background-color: #efefef;
    }

    div.backdate {
        border : 1px solid gray;
        color: gray;
        background: #bbb;
    }

    div.holiday {
        background-color: #ddf;
    }



</style>
</html>