<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>

<body>
    <div class="controls">
        <button id="btnLastYear">Previous Year</button>
    </div>
    <div class="controls">
        <label id="currentYear"></label>
    </div>
    <div class="controls">
        <button id="btnNextYear">Next Year</button>
    </div>
    <div class="controls">
        <select id="selectMonth"></select>
    </div>
    <br>
    <hr>
    <div id="calendar"></div>
</body>

<script>

    const SUNDAY = 0;
    const MONDAY = 1;
    const TUESDAY = 2;
    const WEDNESDAY = 3;
    const THURSDAY = 4;
    const FRIDAY = 5;
    const SATURDAY = 6;

    const JANUARY = 0;
    const FEBRUARY = 1;
    const MARCH = 2;
    const APRIL = 3;
    const MAY = 4;
    const JUNE = 5;
    const JULY = 6; 
    const AUGUST = 7;
    const SEPTEMBER = 8;
    const OCTOBER = 9;
    const NOVEMBER = 10;
    const DECEMBER = 11;

    const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    // 2012 Federal Pay Period 1 : 20120101
    
    Date.prototype.getWeekDay = function()
    {        
        return WEEKDAYS[this.getDay()];
    }

    Date.prototype.nextDate = function()
    {
        this.setDate(this.getDate()+1);
    }

    Date.nthDayOfMonth = function(count, day, month, year, name = "")
    {
        if (year == null) year = new Date().getFullYear();
        var date = new Date(year, month, 1);
        var counter = 0;
        if (date.getWeekDay() == WEEKDAYS[day]) counter++;
        while (counter < count) 
        {
            date.nextDate();
            if (date.getWeekDay() == WEEKDAYS[day]) counter++;
        }
        date.holidayName = name;
        return date;
    }

    Date.lastDayOfMonth = function(day, month, year, name = "")
    {        
        if (year == null) year = new Date().getFullYear();
        var date = new Date(year, month, 1);
        var list = [];
        while (date.getMonth() == month) 
        {
            if (date.getWeekDay() == WEEKDAYS[day])
            {                
                list.push(new Date(date));                
            } 
            date.nextDate();            
            if (date.getMonth() > month) break;                     
        }
        date = list.pop();
        date.holidayName = name;
        return date;
    }

    Date.prototype.backDate = function(offset)
    {
        this.setDate(this.getDate() - offset);
        this.isBackdate = true;        
        return this;
    }

    Date.findSetHoliday = function(month, date, year, name = "")
    {
        if (year == null) year = new Date().getFullYear();
        var holiday = new Date(year, month, date);
        if (holiday.getDay() == SATURDAY)
        {
            holiday.backDate(1);            
        }
        else if (holiday.getDay() == SUNDAY)
        {
            holiday.nextDate();
        }
        holiday.holidayName = name;
        return holiday; 
    }

    Date.NewYear = function(year)
    {
        var newDate = new Date();
        if (year == null) year = new Date().getFullYear();
        newDate.setFullYear(year);
        newDate.setDate(1);
        newDate.setMonth(JANUARY);
        newDate.holidayName = "New Year's Day"
        return newDate;        
    }

    Date.getFederalHolidays = function(startDate)
    {
        function calendarYear(month)
        {
            if (month < startDate.getMonth()) 
                return startDate.getFullYear() + 1;
            else
                return startDate.getFullYear();
        }
        
        return [
            Date.NewYear(calendarYear(JANUARY)),
            Date.nthDayOfMonth(3,MONDAY, JANUARY, calendarYear(JANUARY), "Martin Luther King's Birthday"),
            Date.nthDayOfMonth(3,MONDAY, FEBRUARY, calendarYear(FEBRUARY), "President's Day"),
            Date.lastDayOfMonth(MONDAY, MAY, calendarYear(MAY), "Memorial Day"),        
            Date.findSetHoliday(JULY,4,calendarYear(JULY), "Independence Day"),
            Date.nthDayOfMonth(1,MONDAY,SEPTEMBER, calendarYear(SEPTEMBER), "Labor Day"),
            Date.nthDayOfMonth(2,MONDAY,OCTOBER, calendarYear(OCTOBER), "Columbus Day"),
            Date.findSetHoliday(NOVEMBER,11, calendarYear(NOVEMBER), "Veteran's Day"),
            Date.nthDayOfMonth(4,THURSDAY,NOVEMBER, calendarYear(NOVEMBER), "Thanksgiving Day"),
            Date.findSetHoliday(DECEMBER,25, calendarYear(DECEMBER), "Christmas Day")
        ];
    }
    
    Date.prototype.getMonthStr = function()
    {        
        return MONTHS[this.getMonth()];
    }

    Date.prototype.toISODateStr = function()
    {
        return this.toISOString().split('T')[0];        
    }

    Date.prototype.toISODate = function()
    {
        return this.toISOString().split('T')[0].replace(/-/g,'');        
    }

    Date.fromISODate = function(str)
    {
        if (str == null || str == "") return null;
        var newDate = null;
        try
        {            
            var year = str.substr(0,4);
            newDate = new Date(year,JANUARY,1);
            if (str.length > 4)
            {
                var month = parseInt(str.substr(4,2))-1;
                newDate.setMonth(month);
            }            
            if (str.length == 8)
            {
                var date = str.substr(6,2);
                newDate.setDate(date);
            }            
        }
        catch (exception)
        {
            console.log(exception);            
        }        
        return newDate;
    }

    Date.prototype.getCalendarStr = function()
    {
        if (this.holidayName == null) this.holidayName = "";
        var calendarStr = this.getWeekDay() + " " + this.getMonthStr() + " " + this.getDate() + ", " + this.getFullYear();
        return calendarStr;
    }

    class Calendar
    {
        myStartDate = new Date();
        myDivId = "calendar";
    
        constructor(divId = "calendar", startDate = new Date())
        {
            this.myStartDate = new Date(startDate);
            this.myDivId = divId;
            this.draw();           
        }

        insertDay(someDate)
        {            
            var day = document.createElement("div");
            day.id = someDate.toISODate();
            day.innerText = someDate.getCalendarStr();        
            day.classList.add("date");  

            if (!someDate.isBackdate)
            {
                var isSunday = someDate.getDay() === 0;
                var isSaturday = someDate.getDay() === 6;
                var isWeekend = isSaturday || isSunday;
                if (isWeekend) day.classList.add("weekend");
                if (isSunday) day.classList.add("sunday");
                if (isSaturday) day.classList.add("saturday");  
            }
            else
            {
                day.classList.add("backdate");
            } 
            
            var calendar = document.getElementById(this.myDivId);
            if (calendar != null) calendar.appendChild(day);
        }    

        draw()
        {
            var days = 365;
            var offsetDays = this.myStartDate.getDay();
            for (var offset = offsetDays; offset > 0; offset--) 
            {
                var date = new Date(this.myStartDate);
                this.insertDay(date.backDate(offset));
            }

            var date = new Date(this.myStartDate);
            for (var count = 0; count <= days; count++) 
            {
                this.insertDay(date);
                date.nextDate();
            }

            Date.getFederalHolidays(this.myStartDate).forEach(function(date)
            {                            
                var calendarDate = document.getElementById(date.toISODate())
                if (calendarDate != null)
                {
                    calendarDate.classList.add("holiday");
                    calendarDate.innerText = calendarDate.innerText + " " + date.holidayName                    
                }            
            });
        }        
    }

    function doDateRedirect(date)
    {
        var url = window.location.href.split('?')[0] + "?" + date.toISODate();
        window.location.href = url;
    }

    
       
    function main() 
    {
        var args = window.location.search.substring(1) || null;
        var start = Date.fromISODate(args) || Date.NewYear();
        document.getElementById("currentYear").innerText = start.toISODateStr();

        var lastyear = new Date(start);
        lastyear.setFullYear(start.getFullYear() - 1);
        document.getElementById("btnLastYear").innerText = lastyear.toISODateStr();
        document.getElementById("btnLastYear").onclick = function(event)
        {
            doDateRedirect(lastyear);
        }

        var nextyear = new Date(start);
        nextyear.setFullYear(start.getFullYear() + 1);
        document.getElementById("btnNextYear").innerText = nextyear.toISODateStr();
        document.getElementById("btnNextYear").onclick = function(event)
        {
            doDateRedirect(nextyear);
        };

        var selectMonth = document.getElementById("selectMonth");

        MONTHS.forEach(function(month, index){            
            var newMonth = document.createElement("option");
            newMonth.value = index;
            newMonth.text = month;
            newMonth.classList.add("month_choice");
            selectMonth.appendChild(newMonth);
        });
   
        selectMonth.selectedIndex = start.getMonth();
        selectMonth.onchange = function(event)
        {
            var month = event.target.selectedIndex;
            var newDate = new Date(start.getFullYear(),month,1);
            doDateRedirect(newDate);
        };
        
        var calendar = new Calendar(divId = "calendar", startDate = start);

    }

    document.addEventListener("DOMContentLoaded", function(event) { 
        main();
    });

    document.addEventListener("orientationchange", function(event){
        switch(window.orientation) 
        {  
            case -90: case 90:  // Device is in landscape mode
                break; 
            default:            // Device is in portrait mode
        }
    });

</script>

<style>
    #calendar {
        display: table;
    }

    div.date {
        float: left;
        border : 1px solid black;
        height: 24vh;
        width: 13vw;
        padding : 1px;
        display: inline;
    }

    hr {
        display: block;
        clear: both;
    }

    div.sunday {
        display: block;
        clear: both;
    }

    div.weekend {
        background-color: #efefef;
    }

    div.backdate {
        border : 1px solid gray;
        color: gray;
        background: #bbb;
    }

    div.holiday {
        background-color: #ddf;
    }

    div.controls {
        float: left;
        margin: 5px;
    }

</style>
</html>